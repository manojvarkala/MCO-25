<?php
/**
 * =============================================================================
 * MODULE: MCO Comprehensive Shortcodes & WP Integration
 * VERSION: 8.1.0
 * =============================================================================
 */

if (!defined('ABSPATH')) exit;

if (!function_exists('mco_load_shortcode_css')) {
    function mco_load_shortcode_css() {
        echo '<style>
        .mco-wrapper { font-family: Inter, system-ui, sans-serif; max-width: 1200px; margin: 0 auto; }
        .mco-book-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        /* ... Additional frontend styles ... */
        </style>';
    }
}
add_action('wp_head', 'mco_load_shortcode_css');

// --- SHORTCODE REGISTRATION ---
add_shortcode('mco_exam_login', 'mco_exam_login_shortcode');
add_shortcode('mco_exam_showcase', 'mco_exam_showcase_shortcode');

if (!function_exists('mco_exam_login_shortcode')) {
    function mco_exam_login_shortcode($atts = []) {
        if (!is_user_logged_in()) {
            return '<div class="mco-login-prompt"><h3>Please Log In</h3><a href="' . wp_login_url(get_permalink()) . '">Log In Now</a></div>';
        }
        $user = wp_get_current_user();
        $token = mco_generate_exam_jwt($user->ID);
        $app_url = get_option('mco_exam_app_url');
        $redirect = add_query_arg(['token' => $token, 'api_url' => get_site_url()], rtrim($app_url, '/') . '/auth');
        return '<script>window.location.href="' . esc_url($redirect) . '";</script><p>Redirecting to portal...</p>';
    }
}
