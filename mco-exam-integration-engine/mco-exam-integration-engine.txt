<?php
/**
 * Plugin Name:       MCO Exam Integration Engine
 * Plugin URI:        https://annapoornainfo.com
 * Description:       Provides the backend API, user authentication (SSO), and content management for the React-based examination app.
 * Version:           2.6.0
 * Author:            Annapoorna Infotech
 * Author URI:        https://annapoornainfo.com
 * License:           GPL v2 or later
 * License URI:       https://www.gnu.org/licenses/gpl-2.0.html
 * Text Domain:       mco-exam-engine
 */
if (!defined('ABSPATH')) exit;

// --- CONSTANTS & INCLUDES ---
define('MCO_PLUGIN_FILE', __FILE__);
define('MCO_PLUGIN_PATH', plugin_dir_path(MCO_PLUGIN_FILE));
define('MCO_PLUGIN_URL', plugin_dir_url(MCO_PLUGIN_FILE));
$plugin_data = get_file_data(MCO_PLUGIN_FILE, array('Version' => 'Version'));
define('MCO_PLUGIN_VERSION', $plugin_data['Version']);

// Include all the functional parts of the plugin
require_once MCO_PLUGIN_PATH . 'includes/mco-cpts.txt';
require_once MCO_PLUGIN_PATH . 'includes/mco-data.txt';
require_once MCO_PLUGIN_PATH . 'includes/mco-api.txt';
require_once MCO_PLUGIN_PATH . 'includes/mco-shortcodes.txt';
require_once MCO_PLUGIN_PATH . 'includes/mco-admin.txt';

// --- INITIALIZATION HOOKS ---
add_action('init', function() {
    mco_register_custom_post_types();
    mco_register_shortcode_hooks();
    if (is_admin()) {
        mco_register_admin_hooks();
    }
});

// Centralized hook for all REST API related setup.
add_action('rest_api_init', 'mco_register_api_hooks');


// --- ACTIVATION & DEACTIVATION HOOKS ---
register_activation_hook(MCO_PLUGIN_FILE, function() {
    mco_register_custom_post_types();
    flush_rewrite_rules();
    delete_transient('mco_app_config_data');
});

register_deactivation_hook(MCO_PLUGIN_FILE, function() {
    flush_rewrite_rules();
});
?>