<?php
if (!defined('ABSPATH')) exit;

// Note: The hook registration function has been removed from this file to fix a timing issue.
// The mco_register_custom_post_types() function is now called directly from the main plugin file's 'init' action.

// --- CUSTOM POST TYPES & TAXONOMIES ---
if (!function_exists('mco_register_custom_post_types')) {
    function mco_register_custom_post_types() {
        $taxonomies = [
            'exam_practice_questions'  => 'Practice Questions',
            'exam_practice_duration'   => 'Practice Duration',
            'exam_cert_questions'      => 'Certification Questions',
            'exam_cert_duration'       => 'Certification Duration',
            'exam_pass_score'          => 'Pass Score'
        ];
        foreach ($taxonomies as $slug => $name) {
            register_taxonomy($slug, 'mco_exam_program', [
                'labels' => ['name' => $name], 
                'public' => true, 
                'hierarchical' => false, 
                'show_in_rest' => true
            ]);
        }

        register_post_type('mco_exam_program', [
            'labels' => ['name' => 'Exam Programs', 'singular_name' => 'Exam Program'],
            // FIX: Set show_in_menu to false. The menu item will be added manually in mco-admin.php.
            // This prevents a race condition during activation that causes a fatal error.
            'public' => true, 'has_archive' => true, 'show_in_menu' => false, 'show_in_rest' => true,
            'supports' => ['title', 'editor', 'thumbnail'], 
            'taxonomies' => array_keys($taxonomies),
            'rewrite' => ['slug' => 'exam-programs'],
        ]);

        register_post_type('mco_recommended_book', [ 
            'labels' => ['name' => 'Recommended Books', 'singular_name' => 'Book'], 
            // FIX: Set show_in_menu to false to prevent fatal activation error.
            'public' => true, 'has_archive' => false, 'show_in_menu' => false, 'show_in_rest' => true,
            'supports' => ['title', 'editor', 'thumbnail'] 
        ]);
    }
}
?>