<?php
// Register API routes
function mco_register_api_routes() {
    register_rest_route('mco-app/v1', '/config', array(
        'methods' => 'GET',
        'callback' => 'mco_get_config_data',
        'permission_callback' => '__return_true' 
    ));
}
add_action('rest_api_init', 'mco_register_api_routes');

// Callback to get all configuration data
function mco_get_config_data() {
    // Attempt to get from transient
    $cached_config = get_transient('mco_app_config');
    if ($cached_config !== false) {
        return new WP_REST_Response($cached_config, 200);
    }
    
    // If not cached, generate it
    $config_data = mco_fetch_and_prepare_data();
    
    // Set transient for 1 hour
    set_transient('mco_app_config', $config_data, HOUR_IN_SECONDS);

    return new WP_REST_Response($config_data, 200);
}
?>
